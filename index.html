<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #111;
    }

    canvas {
      display: block;
    }
  </style>
</head>

<body>
<canvas id="gameCanvas"></canvas>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  // Resize canvas to full screen
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  let objects = [];

  function addRect(x, y, width, height, color, curve, rotation = 0) {
    objects.push({
      type: "rect",
      x: x,
      y: y,
      width: width,
      height: height,
      color: color,
      curve: curve,
      rotation: rotation,
      vx: 0,   // velocity X
      vy: 0    // velocity Y
    });
  }
  function addText(x, y, text, color, font, size) {
    objects.push({
      type: "text",
      x: x,
      y: y,
      text: text,
      color: color,
      font: font,
      size: size
    });
  }
  function addImage(x, y, width, height, src) {
    let img = new Image();
    img.src = src;

    objects.push({
      type: "image",
      x: x,
      y: y,
      width: width,
      height: height,
      img: img
    });
  }
function clicked(i) {
  return ((Math.abs(((objects[i].x + offset/4)*scalex  + objects[i].width*scalex / 2) - (mouseX - offset)) < objects[i].width*scalex / 2)  && (Math.abs((objects[i].y*scaley + objects[i].height*scaley/2) - mouseY) < objects[i].height*scaley / 2));
}

function drawRoundedRect(x, y, width, height, radius, color) {
    ctx.fillStyle = color;

    ctx.beginPath();
    ctx.moveTo(x + radius, y);
    ctx.lineTo(x + width - radius, y);
    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
    ctx.lineTo(x + width, y + height - radius);
    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
    ctx.lineTo(x + radius, y + height);
    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
    ctx.lineTo(x, y + radius);
    ctx.quadraticCurveTo(x, y, x + radius, y);
    ctx.closePath();

    ctx.fill();
  }

  let mouseX = 0;
  let mouseY = 0;

  canvas.addEventListener("pointerdown", (event) => {
    mouseX = event.clientX;
    mouseY = event.clientY;

    console.log("Clicked at:", mouseX, mouseY);

  });

  let frames = 0;

  let initialized = false;
  let state = 0;
  let global1 = 0;
  let global2 = 0;
  let global3 = 0;

  function logic() {
    switch (state) {
      case 0: // Scene 1 : will you be my valentine?
         if (!initialized) {
            addImage(100, 700,200, 200, "./Assets/Yes.png");
            addImage(300, 700,200, 200, "./Assets/No.png");
            addImage(100, 100, 400, 200, "./Assets/Question.png");
            addImage(100, 300,200, 400, "./Assets/Nick.png");
            addImage(300, 300,200, 400, "./Assets/Thayna.png");
            initialized = true;
         }
         // check for yes press
         if (clicked(0)) {
          console.log("PRESSED YES");
          state = 1;
          initialized = false;
          mouseX, mouseY = 0;
         }
         // check for no press
         if (clicked(1)) {
          console.log("PRESSED NO");
          state = 2;
          initialized = false;
          mouseX, mouseY = 0;
         }
        break;
      case 1: // Scene 2 : Happy Family
         console.log("RAN");
         if (!initialized) {
            objects.length = 0;
            addImage(200, 100,200, 200, "./Assets/Heart.png");
            addImage(100, 300,200, 400, "./Assets/Nick.png");
            addImage(300, 300,200, 400, "./Assets/Thayna.png");
            initialized = true;
         }
        break;
      case 2: // ICE ARRIVES
        if (!initialized) {
          objects.length = 0;
          frames = 0;
          addImage(200, 300,200, 400, "./Assets/Thayna.png");
          addImage(-200, 300,200, 400, "./Assets/ICE1.png"); // ideal location 50
          addImage(600, 300,200, 400, "./Assets/ICE2.png"); // ideal location 350
          global1 = (50 - objects[1].x) / (30 * 9); // 9 = 9 seconds
          global2 = (350 - objects[2].x) / (30 * 9); // 9 = 9 seconds
          initialized = true;
        }
        frames += 1;
        objects[1].x += global1
        objects[2].x += global2
        if (frames >= 30*9) {
          state = 3;
          frames = 0;
          initialized = false;
        }
        console.log(objects[1].x);
        break;
      case 3: // ask question again
        if (!initialized) { 
          objects.length = 0;
          frames = 0;
          addImage(200, 300,200, 400, "./Assets/Prison.png");
          addImage(50, 300,200, 400, "./Assets/ICE1.png"); // ideal location 50
          addImage(350, 300,200, 400, "./Assets/ICE2.png"); // ideal location 350
          addImage(100, 700,200, 200, "./Assets/Yes.png");
          addImage(300, 700,200, 200, "./Assets/No.png");
          addImage(100, 100, 400, 200, "./Assets/Question.png");
          initialized = true;
        }
        if (clicked(3)) {
          state = 1;
          initialized = false;
          mouseX, mouseY = 0;
        } else if (clicked(4)) {
          state = 4;
          initialized = false;
          console.log("TO BRAZIL");
          mouseX, mouseY = 0;
        }
        break;
      case 4: // flight to brazil
        if (!initialized) { 
          objects.length = 0;
          frames = 0;
          addImage(25, 300,300, 300, "./Assets/USA.png");
          addImage(375, 300,300, 300, "./Assets/Brazil.png"); // ideal location 50
          global1 = 200;
          global2 = 425;
          addImage(0, 0,200, 400, "./Assets/Plane.png"); // 200 425 for USA :  550 425 for Brazil
          initialized = true;
          global3 = (550 - 200) / 100;
        }
        frames += 1;
        k = frames /2;
        // adjust size
        if (k <= 100) {
          objects[2].width = -(Math.pow(k-50,2))/12.5 + 200;
          objects[2].height = 2 * objects[2].width;
          objects[2].x = global1 - objects[2].width/2 + global3*k;
          objects[2].y = global2 - objects[2].height/2;
        }
        
        break;
    }

  }
  let scalex = 2;
  let scaley = 2;
  let offset = 0;
  function draw() {
    // Clear screen
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    //console.log(objects.length)
    
    for (let ob of objects) {
      ob.x += offset;
      if (ob.type == "rect") { // Draw rectangle
        ctx.save();
        ctx.translate(ob.x * scalex + (ob.width * scalex)/2, ob.y * scaley + (ob.height* scaley)/2);
        ctx.rotate(ob.rotation);
        drawRoundedRect(-(ob.width*scalex)/2, -(ob.height*scaley)/2, (ob.width*scalex), (ob.height*scaley), ob.curve, ob.color);
        ctx.restore();
      } else if (ob.type == "text") { // Draw text
        ctx.fillStyle = ob.color;
        ctx.font = `${ob.size*(scalex+scaley)/2}px ${ob.font}`;
        ctx.fillText(ob.text, ob.x*scalex, ob.y*scaley);
      } else if (ob.type == "image") { // Draw image 
        if (ob.img.complete) {
          if (
            ob.img &&
            ob.img.complete &&
            ob.img.naturalWidth !== 0 &&
            ob.x * scalex + ob.width * scalex > 0 &&
            ob.y * scaley + ob.height * scaley > 0 &&
            ob.x * scalex < canvas.width &&
            ob.y * scaley < canvas.height
          ) {
            ctx.drawImage(
              ob.img,
              ob.x * scalex,
              ob.y * scaley,
              ob.width * scalex,
              ob.height * scaley
            );
          }
        }
      }
      ob.x -= offset;
    }

    

  }
  let fpsLimit = 30;
  let frameTime = 1000 / fpsLimit; // ms per frame
  let lastFrame = 0;
  function mainLoop() {
    timestamp = Date.now();
    scalex = Math.min(canvas.width / 600, 2);
    if (scalex == 2) {
      offset = (canvas.width - 1200)/4;
    } else {
      offset = 0;
    }
    scaley = canvas.height / 1080;
    if (timestamp - lastFrame >= frameTime) {
      lastFrame = timestamp;
      logic();
      draw();
    }
    requestAnimationFrame(mainLoop);
  }



  mainLoop();
</script>
</body>
</html>
